function googleSuccess(){app.model.requestTimer=setTimeout(function(){app.model.timedOut=!0,app.model.googleError()},1e4),app.model.init()}var app=app||{};app.ViewModel=function(){app.ViewModel.viewData=[],app.ViewModel.view=ko.observable("app-template"),app.ViewModel.yelpErrorMessage=ko.observableArray(),app.ViewModel.businesses=ko.observableArray(),app.ViewModel.currentPlaceName=ko.observableArray(),app.ViewModel.markers=ko.observableArray(),app.ViewModel.toggleBounce=function(){app.ViewModel.markers().forEach(function(e){e.setAnimation(null)}),app.model.currentMarker.setAnimation(google.maps.Animation.BOUNCE)},app.ViewModel.addMarker=function(e,o){app.ViewModel.markers()[e].setMap(o)},app.ViewModel.setMapOnAll=function(e){for(var o=0;o<app.ViewModel.markers().length;o++)app.ViewModel.markers()[o].setMap(e)},app.ViewModel.filterMarkers=function(e){app.ViewModel.setMapOnAll(null),app.ViewModel.markers().forEach(function(o,a){var n=o.title;e||app.ViewModel.setMapOnAll(app.model.map),-1!==n.toLowerCase().indexOf(e)&&app.ViewModel.addMarker(a,app.model.map)})},app.ViewModel.koFilter=ko.observable(""),app.ViewModel.filteredItems=ko.computed(function(){var e=app.ViewModel.koFilter().toLowerCase();return e?(app.ViewModel.filterMarkers(e),ko.utils.arrayFilter(app.ViewModel.markers(),function(o){return-1!==o.title.toLowerCase().indexOf(e)})):(app.ViewModel.filterMarkers(e),app.ViewModel.markers())}),app.ViewModel.viewData.push({filteredItems:app.ViewModel.filteredItems,koFilter:app.ViewModel.koFilter,showInfowindow:app.ViewModel.showInfowindow}),app.ViewModel.showInfowindow=function(e){app.ViewModel.koFilter(""),google.maps.event.trigger(e,"click")}};var app=app||{};app.model={locations:["320 Pioneer Way, Mountain View, CA 94041, United States","80 W El Camino Real, Mountain View, CA 94040, United States","Grant Park Plaza, 1040 Grant Road #350, Mountain View, CA 94040, United States","635 W Dana St, Mountain View, CA 94041, United States","53 W El Camino Real, Mountain View, CA 94040, United States","Grant Park Plaza, 1040 Grant Rd, Mountain View, CA 94040, United States","145 E Dana St, Mountain View, CA 94041, United States","701 E El Camino Real, Mountain View, CA 94040, United States","Grant Park Plaza, 1350 Grant Rd Suite 8, Mountain View, CA 94040, United States","750 Castro St, Mountain View, CA 94041, United States"],googleMap:'<div id="map"></div>',currentMarker:null,markers:[],mapOptions:{disableDefaultUI:!0},service:null,infoWindow:null,errorInfoWindow:null,loadingInfoWindow:null,timedOut:!1,map:null,requestTimer:null,stop:!1,isInfoWindowLoaded:!1,isYelpError:!1,isErrorInfoWindowLoaded:!1,getInfoWindow:function(){var e='<div id="info-window"><h4 data-bind="text: app.ViewModel.currentPlaceName"></h4><h6><strong>The 3 other nearby places via Yelp</strong></h6><table class="table table-striped table-condensed" id="marker-tbl"><thead><tr><th> Business </th><th> Rated </th><th class="hidden-xs"> Phone </th></tr> </thead><tbody data-bind="template: { name: \'business-template\', foreach: app.ViewModel.businesses, as: \'business\' }"></tbody></table></div>';return app.model.isInfoWindowLoaded=!1,new google.maps.InfoWindow({content:e})},getErrorInfoWindow:function(){var e='<div id="error-info-window" data-bind="template:{ name: \'yelp-error-template\', data: app.ViewModel.yelpErrorMessage }">';return app.model.isErrorInfoWindowLoaded=!1,new google.maps.InfoWindow({content:e})},getLoadingInfoWindow:function(){var e='<i class="fa fa-refresh fa-spin" style="font-size:20px"></i>';return new google.maps.InfoWindow({content:e})},bounds:null,centerMap:function(){app.model.map.setCenter(app.model.bounds.getCenter())},auth:{consumerKey:"CczkBNRj_eaoMgqd0o4n1A",consumerSecret:"jfMHfpHubGUZWRBXVAjTaTMRrbo",accessToken:"0IKGCVVzoRIpB2WKQtFPYa_stRAlzmYO",accessTokenSecret:"JEoYIbjq2NJkywPo7HBu_pG4GgE",serviceProvider:{signatureMethod:"HMAC-SHA1"}},getYelpData:function(e){var o="business",a=e.formatted_address,n=3,p={consumerSecret:app.model.auth.consumerSecret,tokenSecret:app.model.auth.accessTokenSecret},t=[];t.push(["term",o]),t.push(["limit",n]),t.push(["location",a]),t.push(["callback","cb"]),t.push(["oauth_consumer_key",app.model.auth.consumerKey]),t.push(["oauth_consumer_secret",app.model.auth.consumerSecret]),t.push(["oauth_token",app.model.auth.accessToken]),t.push(["oauth_signature_method","HMAC-SHA1"]);var r={action:"http://api.yelp.com/v2/search",method:"GET",parameters:t};OAuth.setTimestampAndNonce(r),OAuth.SignatureMethod.sign(r,p);var i=OAuth.getParameterMap(r.parameters);i.oauth_signature=OAuth.percentEncode(i.oauth_signature);var d=setTimeout(function(){app.model.handleError("Yelp data retrieval error!")},5e3);$.ajax({url:r.action,data:i,cache:!0,dataType:"jsonp",jsonpCallback:"cb"}).done(function(o){app.model.closeInfoWindow(),clearTimeout(d);var a=o.businesses;app.ViewModel.currentPlaceName([]),app.ViewModel.currentPlaceName.push(e.title);var n=app.model.map;app.model.infoWindow.open(n,e),app.ViewModel.businesses([]),a.forEach(function(e){app.ViewModel.businesses.push(e)})}).fail(function(e,o,a){app.model.handleError(o)})},handleError:function(e){var o=app.model.map,a=app.model.currentMarker;app.model.closeInfoWindow(),app.model.errorInfoWindow.open(o,a);var n="Error: "+e+" \n\nPlease Try again.";app.ViewModel.yelpErrorMessage([]),app.ViewModel.yelpErrorMessage.push(n)},googleError:function(){return app.ViewModel.view("error-template"),app.model.stop=!0,!0},init:function(){$(".mapDiv").append(app.model.googleMap),app.model.map=new google.maps.Map(document.getElementById("map"),app.model.mapOptions),app.model.service=new google.maps.places.PlacesService(app.model.map),app.model.infoWindow=app.model.getInfoWindow(),app.model.errorInfoWindow=app.model.getErrorInfoWindow(),app.model.loadingInfoWindow=app.model.getLoadingInfoWindow(),google.maps.event.addListener(app.model.infoWindow,"domready",function(){app.model.isInfoWindowLoaded||(ko.applyBindings(appViewModel,$("#info-window")[0]),app.model.isInfoWindowLoaded=!0)}),google.maps.event.addListener(app.model.errorInfoWindow,"domready",function(){app.model.isErrorInfoWindowLoaded||(ko.applyBindings(appViewModel,$("#error-info-window")[0]),app.model.isErrorInfoWindowLoaded=!0)}),window.mapBounds=new google.maps.LatLngBounds,app.model.locations.forEach(function(e){var o={query:e};app.model.service.textSearch(o,app.model.textSerachCallback)}),google.maps.event.addListener(app.model.map,"click",app.model.closeInfoWindow),window.addEventListener("resize",function(e){app.model.map.fitBounds(window.mapBounds)})},closeInfoWindow:function(){app.model.infoWindow.close(),app.model.errorInfoWindow.close(),app.model.loadingInfoWindow.close()},textSerachCallback:function(e,o){if(o!==google.maps.places.PlacesServiceStatus.OK)return app.model.googleError(),void window.alert("Error retrieving list of places, Try Again");console.log(e[0]),app.model.createMapMarker(e[0]);e[0]},createMapMarker:function(e){var o=e.geometry.location.lat(),a=e.geometry.location.lng(),n=e.name;app.model.bounds=window.mapBounds;var p=new google.maps.Marker({map:app.model.map,position:e.geometry.location,title:n,placeId:e.place_id,draggable:!0,animation:google.maps.Animation.DROP,formatted_address:e.formatted_address});app.model.markers.push(p),app.ViewModel.markers.push(p),app.model.locations.length===app.model.markers.length&&(app.model.timedOut=!1,clearTimeout(app.model.requestTimer)),google.maps.event.addListener(p,"click",function(){app.model.map.panTo(p.getPosition());setTimeout(function(){p.setAnimation(null)},5e3);app.model.currentMarker=null,app.model.currentMarker=p;var e=app.model.map;app.model.closeInfoWindow(),app.model.loadingInfoWindow.open(e,p),app.model.getYelpData(app.model.currentMarker)}),p.addListener("click",app.ViewModel.toggleBounce),app.model.bounds.extend(new google.maps.LatLng(o,a)),app.model.map.fitBounds(app.model.bounds),app.model.centerMap()}};var appViewModel=new app.ViewModel;ko.applyBindings(appViewModel);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhlbHBlci5qcyJdLCJuYW1lcyI6WyJnb29nbGVTdWNjZXNzIiwiYXBwIiwibW9kZWwiLCJyZXF1ZXN0VGltZXIiLCJzZXRUaW1lb3V0IiwidGltZWRPdXQiLCJnb29nbGVFcnJvciIsImluaXQiLCJWaWV3TW9kZWwiLCJ2aWV3RGF0YSIsInZpZXciLCJrbyIsIm9ic2VydmFibGUiLCJ5ZWxwRXJyb3JNZXNzYWdlIiwib2JzZXJ2YWJsZUFycmF5IiwiYnVzaW5lc3NlcyIsImN1cnJlbnRQbGFjZU5hbWUiLCJtYXJrZXJzIiwidG9nZ2xlQm91bmNlIiwiZm9yRWFjaCIsIm1hcmsiLCJzZXRBbmltYXRpb24iLCJjdXJyZW50TWFya2VyIiwiZ29vZ2xlIiwibWFwcyIsIkFuaW1hdGlvbiIsIkJPVU5DRSIsImFkZE1hcmtlciIsImluZGV4IiwibWFwIiwic2V0TWFwIiwic2V0TWFwT25BbGwiLCJpIiwibGVuZ3RoIiwiZmlsdGVyTWFya2VycyIsImZpbHRlciIsIm1hcmtlciIsIm1hcmtlclN0ciIsInRpdGxlIiwidG9Mb3dlckNhc2UiLCJpbmRleE9mIiwia29GaWx0ZXIiLCJmaWx0ZXJlZEl0ZW1zIiwiY29tcHV0ZWQiLCJ1dGlscyIsImFycmF5RmlsdGVyIiwiaXRlbSIsInB1c2giLCJzaG93SW5mb3dpbmRvdyIsImV2ZW50IiwidHJpZ2dlciIsImxvY2F0aW9ucyIsImdvb2dsZU1hcCIsIm1hcE9wdGlvbnMiLCJkaXNhYmxlRGVmYXVsdFVJIiwic2VydmljZSIsImluZm9XaW5kb3ciLCJlcnJvckluZm9XaW5kb3ciLCJsb2FkaW5nSW5mb1dpbmRvdyIsInN0b3AiLCJpc0luZm9XaW5kb3dMb2FkZWQiLCJpc1llbHBFcnJvciIsImlzRXJyb3JJbmZvV2luZG93TG9hZGVkIiwiZ2V0SW5mb1dpbmRvdyIsInRlbXBsYXRlQmluZGluZyIsIkluZm9XaW5kb3ciLCJjb250ZW50IiwiZ2V0RXJyb3JJbmZvV2luZG93IiwiZ2V0TG9hZGluZ0luZm9XaW5kb3ciLCJib3VuZHMiLCJjZW50ZXJNYXAiLCJzZXRDZW50ZXIiLCJnZXRDZW50ZXIiLCJhdXRoIiwiY29uc3VtZXJLZXkiLCJjb25zdW1lclNlY3JldCIsImFjY2Vzc1Rva2VuIiwiYWNjZXNzVG9rZW5TZWNyZXQiLCJzZXJ2aWNlUHJvdmlkZXIiLCJzaWduYXR1cmVNZXRob2QiLCJnZXRZZWxwRGF0YSIsInRlcm1zIiwibmVhciIsImZvcm1hdHRlZF9hZGRyZXNzIiwibGltaXQiLCJhY2Nlc3NvciIsInRva2VuU2VjcmV0IiwicGFyYW1ldGVycyIsIm1lc3NhZ2UiLCJhY3Rpb24iLCJtZXRob2QiLCJPQXV0aCIsInNldFRpbWVzdGFtcEFuZE5vbmNlIiwiU2lnbmF0dXJlTWV0aG9kIiwic2lnbiIsInBhcmFtZXRlck1hcCIsImdldFBhcmFtZXRlck1hcCIsIm9hdXRoX3NpZ25hdHVyZSIsInBlcmNlbnRFbmNvZGUiLCJhcGlUaW1lb3V0IiwiaGFuZGxlRXJyb3IiLCIkIiwiYWpheCIsInVybCIsImRhdGEiLCJjYWNoZSIsImRhdGFUeXBlIiwianNvbnBDYWxsYmFjayIsImRvbmUiLCJjbG9zZUluZm9XaW5kb3ciLCJjbGVhclRpbWVvdXQiLCJ0ZW1wTWFwIiwib3BlbiIsImJ1c2luZXNzIiwiZmFpbCIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwiZXJyb3IiLCJ0ZW1wTWFya2VyIiwiYXBwZW5kIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInBsYWNlcyIsIlBsYWNlc1NlcnZpY2UiLCJhZGRMaXN0ZW5lciIsImFwcGx5QmluZGluZ3MiLCJhcHBWaWV3TW9kZWwiLCJ3aW5kb3ciLCJtYXBCb3VuZHMiLCJMYXRMbmdCb3VuZHMiLCJwbGFjZSIsInJlcXVlc3QiLCJxdWVyeSIsInRleHRTZWFyY2giLCJ0ZXh0U2VyYWNoQ2FsbGJhY2siLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImZpdEJvdW5kcyIsImNsb3NlIiwicmVzdWx0cyIsInN0YXR1cyIsIlBsYWNlc1NlcnZpY2VTdGF0dXMiLCJPSyIsImFsZXJ0IiwiY29uc29sZSIsImxvZyIsImNyZWF0ZU1hcE1hcmtlciIsInBsYWNlRGF0YSIsImxhdCIsImdlb21ldHJ5IiwibG9jYXRpb24iLCJsb24iLCJsbmciLCJuYW1lIiwiTWFya2VyIiwicG9zaXRpb24iLCJwbGFjZUlkIiwicGxhY2VfaWQiLCJkcmFnZ2FibGUiLCJhbmltYXRpb24iLCJEUk9QIiwicGFuVG8iLCJnZXRQb3NpdGlvbiIsImV4dGVuZCIsIkxhdExuZyJdLCJtYXBwaW5ncyI6IkFBV0EsUUFBQUEsaUJBRUFDLElBQUFDLE1BQUFDLGFBQUFDLFdBQUEsV0FDQUgsSUFBQUMsTUFBQUcsVUFBQSxFQUNBSixJQUFBQyxNQUFBSSxlQUNBLEtBSUFMLElBQUFDLE1BQUFLLE9BZEEsR0FBQU4sS0FBQUEsT0FxQkFBLEtBQUFPLFVBQUEsV0FHQVAsSUFBQU8sVUFBQUMsWUFFQVIsSUFBQU8sVUFBQUUsS0FBQUMsR0FBQUMsV0FBQSxnQkFFQVgsSUFBQU8sVUFBQUssaUJBQUFGLEdBQUFHLGtCQUVBYixJQUFBTyxVQUFBTyxXQUFBSixHQUFBRyxrQkFFQWIsSUFBQU8sVUFBQVEsaUJBQUFMLEdBQUFHLGtCQUVBYixJQUFBTyxVQUFBUyxRQUFBTixHQUFBRyxrQkFNQWIsSUFBQU8sVUFBQVUsYUFBQSxXQUNBakIsSUFBQU8sVUFBQVMsVUFBQUUsUUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxhQUFBLFFBRUFwQixJQUFBQyxNQUFBb0IsY0FBQUQsYUFBQUUsT0FBQUMsS0FBQUMsVUFBQUMsU0FNQXpCLElBQUFPLFVBQUFtQixVQUFBLFNBQUFDLEVBQUFDLEdBQ0E1QixJQUFBTyxVQUFBUyxVQUFBVyxHQUFBRSxPQUFBRCxJQUtBNUIsSUFBQU8sVUFBQXVCLFlBQUEsU0FBQUYsR0FDQSxJQUFBLEdBQUFHLEdBQUEsRUFBQUEsRUFBQS9CLElBQUFPLFVBQUFTLFVBQUFnQixPQUFBRCxJQUNBL0IsSUFBQU8sVUFBQVMsVUFBQWUsR0FBQUYsT0FBQUQsSUFPQTVC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R0FoSyxZQUFBLFdBQ0FnQyxFQUFBZixhQUFBLE9BQ0EsSUFFQXBCLEtBQUFDLE1BQUFvQixjQUFBLEtBQ0FyQixJQUFBQyxNQUFBb0IsY0FBQWMsQ0FDQSxJQUFBMkUsR0FBQTlHLElBQUFDLE1BQUEyQixHQUNBNUIsS0FBQUMsTUFBQTJHLGtCQUNBNUcsSUFBQUMsTUFBQXdELGtCQUFBc0QsS0FBQUQsRUFBQTNFLEdBRUFuQyxJQUFBQyxNQUFBOEUsWUFBQS9FLElBQUFDLE1BQUFvQixpQkFHQWMsRUFBQTBGLFlBQUEsUUFBQTdILElBQUFPLFVBQUFVLGNBSUFqQixJQUFBQyxNQUFBbUUsT0FBQWdHLE9BQUEsR0FBQTlJLFFBQUFDLEtBQUE4SSxPQUFBaEIsRUFBQUcsSUFFQXhKLElBQUFDLE1BQUEyQixJQUFBOEcsVUFBQTFJLElBQUFDLE1BQUFtRSxRQUdBcEUsSUFBQUMsTUFBQW9FLGFBS0EsSUFBQTBELGNBQUEsR0FBQS9ILEtBQUFPLFNBQ0FHLElBQUFvSCxjQUFBQyIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBqc2xpbnQgYnJvd3Nlcjp0cnVlKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzKi9cbi8qIGdsb2JhbCB3aW5kb3csICQsIGdvb2dsZSwgZG9jdW1lbnQsIGtvKi9cbi8qIGVzbGludCBuby1uZWdhdGVkLWNvbmRpdGlvbjogMiovXG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZS1iZWZvcmUtZGVmaW5lKi9cbnZhciBhcHAgPSBhcHAgfHwge307XG5cbi8qKlxuKlxuKi9cbmZ1bmN0aW9uIGdvb2dsZVN1Y2Nlc3MoKSB7XG4gLy8gdGltZXIgZm9yIGZhbGxiYWNrIGluIGNhc2UgcmVxdWVzdHMgYXJlIHRha2luZyB0b28gbG9uZ1xuICBhcHAubW9kZWwucmVxdWVzdFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICBhcHAubW9kZWwudGltZWRPdXQgPSB0cnVlO1xuICAgIGFwcC5tb2RlbC5nb29nbGVFcnJvcigpO1xuICB9LCAxMDAwMCk7XG4gIC8vIHBpblBvc3Rlcihsb2NhdGlvbnMpIGNyZWF0ZXMgcGlucyBvbiB0aGUgbWFwIGZvciBlYWNoIGxvY2F0aW9uIGluXG4gIC8vIHRoZSBsb2NhdGlvbnMgYXJyYXlcbiAgLy8gdGhlIGlmIHN0YXRlbWVudCBjaGVja3MgdG8gc2VlIGlmIGl0cyBvayB0byBwcm9jZWVkIHdpdGggdGhlIHJlcXVlc3QgZm9yIHRoZSBpbml0aWFsIGRhdGEgZm9yIHRoZSBtYXAgbG9jYXRpb25zXG4gIGFwcC5tb2RlbC5pbml0KCk7XG59XG5cbi8qKlxuKiBAZGVzY3JpcHRpb24gVmlld01vZGVsXG4qIEBjb25zdHJ1Y3RvclxuKi9cbmFwcC5WaWV3TW9kZWwgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICAvLyBTdG9yZXMga25vY2tvdXQgdGVtcGxhdGUgYmluZGluZyBkYXRhIGZvciB0aGUgbWFpbiB2aWV3XG4gIGFwcC5WaWV3TW9kZWwudmlld0RhdGEgPSBbXTtcbiAgLy8gU3RvcmVzIG5hbWUgb2YgdGhlIGtub2Nrb3V0IHRlbXBsYXRlIHRvIGJlIHVzZWQgZm9yIHRoZSBtYWluIHZpZXdcbiAgYXBwLlZpZXdNb2RlbC52aWV3ID0ga28ub2JzZXJ2YWJsZSgnYXBwLXRlbXBsYXRlJyk7XG4gIC8vIFllbHAgZXJyb3IgbWVzc2FnZVxuICBhcHAuVmlld01vZGVsLnllbHBFcnJvck1lc3NhZ2UgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgLy8gWWVscCBidXNpbmVzcyBkYXRhIHJldHJpZXZlZFxuICBhcHAuVmlld01vZGVsLmJ1c2luZXNzZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgLy8gTmFtZSBvZiB0aGUgc2VsZWN0ZWQgcGxhY2UgZm9yIGluZm9XaW5kb3dcbiAgYXBwLlZpZXdNb2RlbC5jdXJyZW50UGxhY2VOYW1lID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XG4gIC8vIGtvIG9ic2VydmFibGUgYXJyYXkgdGhhdCBzdG9yZXMgdGhlIG1hcmtlcnMgdXNlZCB0byBjcmVhdGUgdGhlIGxpc3QgdmlldyBhbmQgcG9wdWxhdGUgdGhlIG1hcFxuICBhcHAuVmlld01vZGVsLm1hcmtlcnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcblxuICAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBBbmltYXRlcyBzZWxlY3RlZCBtYXJrZXIgd2l0aCBhIGJvdW5jZSBhbmltYXRpb25cbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICBhcHAuVmlld01vZGVsLnRvZ2dsZUJvdW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgIGFwcC5WaWV3TW9kZWwubWFya2VycygpLmZvckVhY2goZnVuY3Rpb24obWFyaykge1xuICAgICAgbWFyay5zZXRBbmltYXRpb24obnVsbCk7XG4gICAgfSk7XG4gICAgYXBwLm1vZGVsLmN1cnJlbnRNYXJrZXIuc2V0QW5pbWF0aW9uKGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5CT1VOQ0UpO1xuICB9O1xuICAvKiBAZGVzY3JpcHRpb24gYWRkIGJhY2sgbWFya2V0IHRvIG1hcFxuICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIHBvc2l0aW9uIG9mIG1hcmtlciBpbiBtYXJrZXJzIGFycmF5XG4gICogQHBhcmFtIHtvYmplY3R9IG1hcCAtIG1hcCBvYmplY3RcbiAgKi9cbiAgYXBwLlZpZXdNb2RlbC5hZGRNYXJrZXIgPSBmdW5jdGlvbihpbmRleCwgbWFwKSB7XG4gICAgYXBwLlZpZXdNb2RlbC5tYXJrZXJzKClbaW5kZXhdLnNldE1hcChtYXApO1xuICB9O1xuICAgIC8qIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSBtYXAgb24gYWxsIG1hcmtlcnMgaW4gdGhlIGFycmF5LlxuICAgICogQHBhcmFtIHtvYmplY3R9IG1hcCAtIG1hcCBvYmplY3RcbiAgICAqL1xuICBhcHAuVmlld01vZGVsLnNldE1hcE9uQWxsID0gZnVuY3Rpb24obWFwKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcHAuVmlld01vZGVsLm1hcmtlcnMoKS5sZW5ndGg7IGkrKykge1xuICAgICAgYXBwLlZpZXdNb2RlbC5tYXJrZXJzKClbaV0uc2V0TWFwKG1hcCk7XG4gICAgfVxuICB9O1xuXG4gICAgLyogQGRlc2NyaXB0aW9uIEZpbHRlcnMgbWFya2VycyBhcnJheSAuXG4gICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyIC0gc3RyaW5nIHVzZWQgdG8gZmlsdGVyIG1hcmtlcnMgYXJyYXlcbiAgICAqL1xuICBhcHAuVmlld01vZGVsLmZpbHRlck1hcmtlcnMgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICBhcHAuVmlld01vZGVsLnNldE1hcE9uQWxsKG51bGwpO1xuXG4gICAgYXBwLlZpZXdNb2RlbC5tYXJrZXJzKCkuZm9yRWFjaChmdW5jdGlvbihtYXJrZXIsIGluZGV4KSB7XG4gICAgICB2YXIgbWFya2VyU3RyID0gbWFya2VyLnRpdGxlO1xuICAgICAgaWYgKCFmaWx0ZXIpIHtcbiAgICAgICAgYXBwLlZpZXdNb2RlbC5zZXRNYXBPbkFsbChhcHAubW9kZWwubWFwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1hcmtlclN0ci50b0xvd2VyQ2FzZSgpLmluZGV4T2YoZmlsdGVyKSAhPT0gLTEpIHtcbiAgICAgICAgYXBwLlZpZXdNb2RlbC5hZGRNYXJrZXIoaW5kZXgsIGFwcC5tb2RlbC5tYXApO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIC8vIGtvIG9ic2VydmFibGUgdGhhdCBjb2xsZWN0cyB0aGUgZmlsdGVyIGZyb20gdGhlIGh0bWwgaW5wdXQgZWxlbWVudFxuICBhcHAuVmlld01vZGVsLmtvRmlsdGVyID0ga28ub2JzZXJ2YWJsZSgnJyk7XG4gIC8vIGFwcC5WaWV3TW9kZWwubXlEYXRhLnB1c2goYXBwLlZpZXdNb2RlbC5rb0ZpbHRlcik7XG4gIC8vIGtvIGNvbXB1dGVkIG9ic2VydmFibGUgdGhhdCB3aWxsIGZpbHRlciB0aGUgbWFya2VycyBvYnNlcnZhYmxlIGFycmF5IGJhc2VkIG9uIHRoZSBmaWx0ZXIgaW5wdXRcbiAgYXBwLlZpZXdNb2RlbC5maWx0ZXJlZEl0ZW1zID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGZpbHRlciA9IGFwcC5WaWV3TW9kZWwua29GaWx0ZXIoKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgaWYgKGZpbHRlcikge1xuICAgICAgYXBwLlZpZXdNb2RlbC5maWx0ZXJNYXJrZXJzKGZpbHRlcik7XG4gICAgICByZXR1cm4ga28udXRpbHMuYXJyYXlGaWx0ZXIoYXBwLlZpZXdNb2RlbC5tYXJrZXJzKCksIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0udGl0bGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGZpbHRlcikgIT09IC0xO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGFwcC5WaWV3TW9kZWwuZmlsdGVyTWFya2VycyhmaWx0ZXIpO1xuICAgIHJldHVybiBhcHAuVmlld01vZGVsLm1hcmtlcnMoKTtcbiAgfSk7XG4gIC8vIFNldCBhcHAgbWFpbiB2aWV3IGRhdGFcbiAgYXBwLlZpZXdNb2RlbC52aWV3RGF0YVxuICAucHVzaCh7ZmlsdGVyZWRJdGVtczogYXBwLlZpZXdNb2RlbC5maWx0ZXJlZEl0ZW1zLCBrb0ZpbHRlcjogYXBwLlZpZXdNb2RlbC5rb0ZpbHRlciwgc2hvd0luZm93aW5kb3c6IGFwcC5WaWV3TW9kZWwuc2hvd0luZm93aW5kb3d9KTtcblxuICAgLyogQGRlc2NyaXB0aW9uIFJlcXVlc3QgcGxhY2UgZGV0YWlscyBmb3IgdGhlIGN1cnJlbnQgbWFya2VyIHNlbGVjdGVkIHZpYSBsaXN0LlxuICAgKiBAcGFyYW0ge29iamVjdH0gbWFya2VyIC0gbWFya2VyIHNlbGVjdGVkIGZyb20gbGlzdCB2aWV3XG4gICAqL1xuICBhcHAuVmlld01vZGVsLnNob3dJbmZvd2luZG93ID0gZnVuY3Rpb24obWFya2VyKSB7XG4gICAgYXBwLlZpZXdNb2RlbC5rb0ZpbHRlcignJyk7XG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcihtYXJrZXIsICdjbGljaycpO1xuICB9O1xufTtcbiIsIi8qIGpzbGludCBicm93c2VyOnRydWUqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMqL1xuLyogZ2xvYmFsIHdpbmRvdywgJCwgT0F1dGgsIGdvb2dsZSwgSGFuZGxlYmFycywgZG9jdW1lbnQsIGtvKi9cbi8qIGVzbGludCBuby1uZWdhdGVkLWNvbmRpdGlvbjogMiovXG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZS1iZWZvcmUtZGVmaW5lKi9cbnZhciBhcHAgPSBhcHAgfHwge307XG5cbmFwcC5tb2RlbCA9IHtcbiAgLy8gaGFyZCBjb2RlZCBsb2NhdGlvbnNcbiAgbG9jYXRpb25zOiBbXG5cbiAgICBcIjMyMCBQaW9uZWVyIFdheSwgTW91bnRhaW4gVmlldywgQ0EgOTQwNDEsIFVuaXRlZCBTdGF0ZXNcIixcbiAgICBcIjgwIFcgRWwgQ2FtaW5vIFJlYWwsIE1vdW50YWluIFZpZXcsIENBIDk0MDQwLCBVbml0ZWQgU3RhdGVzXCIsXG4gICAgXCJHcmFudCBQYXJrIFBsYXphLCAxMDQwIEdyYW50IFJvYWQgIzM1MCwgXCIgK1xuICAgIFwiTW91bnRhaW4gVmlldywgQ0EgOTQwNDAsIFVuaXRlZCBTdGF0ZXNcIixcbiAgICBcIjYzNSBXIERhbmEgU3QsIE1vdW50YWluIFZpZXcsIENBIDk0MDQxLCBVbml0ZWQgU3RhdGVzXCIsXG4gICAgXCI1MyBXIEVsIENhbWlubyBSZWFsLCBNb3VudGFpbiBWaWV3LCBDQSA5NDA0MCwgVW5pdGVkIFN0YXRlc1wiLFxuICAgIFwiR3JhbnQgUGFyayBQbGF6YSwgMTA0MCBHcmFudCBSZCwgTW91bnRhaW4gVmlldywgQ0EgOTQwNDAsIFVuaXRlZCBTdGF0ZXNcIixcbiAgICBcIjE0NSBFIERhbmEgU3QsIE1vdW50YWluIFZpZXcsIENBIDk0MDQxLCBVbml0ZWQgU3RhdGVzXCIsXG4gICAgXCI3MDEgRSBFbCBDYW1pbm8gUmVhbCwgTW91bnRhaW4gVmlldywgQ0EgOTQwNDAsIFVuaXRlZCBTdGF0ZXNcIixcbiAgICBcIkdyYW50IFBhcmsgUGxhemEsIDEzNTAgR3JhbnQgUmQgU3VpdGUgOCwgXCIgK1xuICAgIFwiTW91bnRhaW4gVmlldywgQ0EgOTQwNDAsIFVuaXRlZCBTdGF0ZXNcIixcbiAgICBcIjc1MCBDYXN0cm8gU3QsIE1vdW50YWluIFZpZXcsIENBIDk0MDQxLCBVbml0ZWQgU3RhdGVzXCJdLFxuICAvLyBkaXYgZm9yIGdvb2dsZSBtYXBcbiAgZ29vZ2xlTWFwOiAnPGRpdiBpZD1cIm1hcFwiPjwvZGl2PicsXG4gIC8vIGN1cnJlbnQgc2VsZWN0ZWQgbWFya2VyXG4gIGN1cnJlbnRNYXJrZXI6IG51bGwsXG4gIC8vIGFycmF5IG9mIG1hcmtlcnMgZ2VuZXJhdGVkXG4gIG1hcmtlcnM6IFtdLFxuICAvLyBvcHRpb25zIGZvciBnb29nbGUgbWFwc1xuICBtYXBPcHRpb25zOiB7ZGlzYWJsZURlZmF1bHRVSTogdHJ1ZX0sXG4gIC8vIHZhciB0aGF0IHN0b3JlcyBnb29nbGUgc2VydmljZVxuICBzZXJ2aWNlOiBudWxsLFxuICAvLyBJbmZvcm1hdGlvbiB3aW5kb3cgdGhhdCBkaXNwbGF5cyBwbGFjZSBkZXRhaWxzXG4gIGluZm9XaW5kb3c6IG51bGwsXG4gIC8vIEluZm9ybWF0aW9uIHdpbmRvdyB0aGF0IGRpc3BsYXlzIHllbHAgZGF0YSByZXRyaWV2YWwgZXJyb3JcbiAgZXJyb3JJbmZvV2luZG93OiBudWxsLFxuICAvLyBJbmZvcm1hdGlvbiB3aW5kb3cgdGhhdCBkaXNwbGF5cyBhIGxvYWRpbmcgYW5pbWF0aW9uXG4gIGxvYWRpbmdJbmZvV2luZG93OiBudWxsLFxuICAvLyBHb29nbGUgcmVxdWVzdCB0aW1lIG91dCBib29sZWFuIHZhclxuICB0aW1lZE91dDogZmFsc2UsXG4gIC8vIEdvb2dsZSBtYXAgb2JqZWN0XG4gIG1hcDogbnVsbCxcbiAgLy8gR29vZ2xlIHJlcXVlc3QgdGltZSBvdXQgdGltZXJcbiAgcmVxdWVzdFRpbWVyOiBudWxsLFxuICBzdG9wOiBmYWxzZSxcbiAgaXNJbmZvV2luZG93TG9hZGVkOiBmYWxzZSxcbiAgaXNZZWxwRXJyb3I6IGZhbHNlLFxuICBpc0Vycm9ySW5mb1dpbmRvd0xvYWRlZDogZmFsc2UsXG4gICAgLyoqXG4gICAgKiBAZGVzY3JpcHRpb24gZ2V0IGFuIGluc3RhbmNlIG9mIHRoZSBpbmZvcm1hdGlvbiB3aW5kb3cgZm9yIGVhY2ggbWFya2VyIHRoYXQgZGlzcGxheXMgcmVxdWVzdCBkZXRhaWxzXG4gICAgKiBAY29uc3RydWN0b3JcbiAgICAqL1xuICBnZXRJbmZvV2luZG93OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdGVtcGxhdGVCaW5kaW5nID1cbiAgICAnPGRpdiBpZD1cImluZm8td2luZG93XCI+JyArXG4gICAgICAnPGg0IGRhdGEtYmluZD1cInRleHQ6IGFwcC5WaWV3TW9kZWwuY3VycmVudFBsYWNlTmFtZVwiPjwvaDQ+JyArXG4gICAgICAnPGg2PjxzdHJvbmc+VGhlIDMgb3RoZXIgbmVhcmJ5IHBsYWNlcyB2aWEgWWVscDwvc3Ryb25nPjwvaDY+JyArXG4gICAgICAnPHRhYmxlIGNsYXNzPVwidGFibGUgdGFibGUtc3RyaXBlZCB0YWJsZS1jb25kZW5zZWRcIiBpZD1cIm1hcmtlci10YmxcIj4nICtcbiAgICAgICAgJzx0aGVhZD48dHI+PHRoPiBCdXNpbmVzcyA8L3RoPjx0aD4gUmF0ZWQgPC90aD4nICtcbiAgICAgICAgJzx0aCBjbGFzcz1cImhpZGRlbi14c1wiPiBQaG9uZSA8L3RoPjwvdHI+IDwvdGhlYWQ+JyArXG4gICAgICAgICc8dGJvZHkgZGF0YS1iaW5kPVwidGVtcGxhdGU6IHsgbmFtZTogXFwnYnVzaW5lc3MtdGVtcGxhdGVcXCcsICcgK1xuICAgICAgICAnZm9yZWFjaDogYXBwLlZpZXdNb2RlbC5idXNpbmVzc2VzLCBhczogXFwnYnVzaW5lc3NcXCcgfVwiPjwvdGJvZHk+JyArXG4gICAgICAgICc8L3RhYmxlPicgK1xuICAgICc8L2Rpdj4nO1xuICAgIGFwcC5tb2RlbC5pc0luZm9XaW5kb3dMb2FkZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe1xuICAgICAgY29udGVudDogdGVtcGxhdGVCaW5kaW5nXG4gICAgfSk7XG4gIH0sXG4gIC8qKlxuICAqIEBkZXNjcmlwdGlvbiBnZXQgYW4gaW5zdGFuY2Ugb2YgdGhlIGluZm9ybWF0aW9uIHdpbmRvdyBmb3IgZWFjaCBtYXJrZXIgdGhhdCBkaXNwbGF5cyByZXF1ZXN0IGVycm9yc1xuICAqIEBjb25zdHJ1Y3RvclxuICAqL1xuICBnZXRFcnJvckluZm9XaW5kb3c6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0ZW1wbGF0ZUJpbmRpbmcgPSAnPGRpdiBpZD1cImVycm9yLWluZm8td2luZG93XCIgZGF0YS1iaW5kPVwidGVtcGxhdGU6JyArXG4gICAgJ3sgbmFtZTogXFwneWVscC1lcnJvci10ZW1wbGF0ZVxcJywgZGF0YTogYXBwLlZpZXdNb2RlbC55ZWxwRXJyb3JNZXNzYWdlIH1cIj4nO1xuICAgIGFwcC5tb2RlbC5pc0Vycm9ySW5mb1dpbmRvd0xvYWRlZCA9IGZhbHNlO1xuICAgIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICBjb250ZW50OiB0ZW1wbGF0ZUJpbmRpbmdcbiAgICB9KTtcbiAgfSxcbiAgLyoqXG4gICogQGRlc2NyaXB0aW9uIGdldCBhbiBpbnN0YW5jZSBvZiB0aGUgaW5mb3JtYXRpb24gd2luZG93IGZvciBlYWNoIG1hcmtlciB0aGF0IGRpc3BsYXlzIHJlcXVlc3QgbG9hZGluZyBhbmltYXRpb25cbiAgKiBAY29uc3RydWN0b3JcbiAgKi9cbiAgZ2V0TG9hZGluZ0luZm9XaW5kb3c6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0ZW1wbGF0ZUJpbmRpbmcgPVxuICAgICc8aSBjbGFzcz1cImZhIGZhLXJlZnJlc2ggZmEtc3BpblwiIHN0eWxlPVwiZm9udC1zaXplOjIwcHhcIj48L2k+JztcbiAgICByZXR1cm4gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe1xuICAgICAgY29udGVudDogdGVtcGxhdGVCaW5kaW5nXG4gICAgfSk7XG4gIH0sXG4gIGJvdW5kczogbnVsbCxcbiAgY2VudGVyTWFwOiBmdW5jdGlvbigpIHtcbiAgICBhcHAubW9kZWwubWFwLnNldENlbnRlcihhcHAubW9kZWwuYm91bmRzLmdldENlbnRlcigpKTtcbiAgfSxcbiAgYXV0aDoge1xuICAgICAgLy9cbiAgICAgIC8vIFVwZGF0ZSB3aXRoIHlvdXIgYXV0aCB0b2tlbnMuXG4gICAgICAvL1xuICAgIGNvbnN1bWVyS2V5OiBcIkNjemtCTlJqX2Vhb01ncWQwbzRuMUFcIixcbiAgICBjb25zdW1lclNlY3JldDogXCJqZk1IZnBIdWJHVVpXUkJYVkFqVGFUTVJyYm9cIixcbiAgICBhY2Nlc3NUb2tlbjogXCIwSUtHQ1ZWem9SSXBCMldLUXRGUFlhX3N0UkFsem1ZT1wiLFxuICAgICAgLy8gVGhpcyBleGFtcGxlIGlzIGEgcHJvb2Ygb2YgY29uY2VwdCwgZm9yIGhvdyB0byB1c2UgdGhlIFllbHAgdjIgQVBJIHdpdGggamF2YXNjcmlwdC5cbiAgICAgIC8vIFlvdSB3b3VsZG4ndCBhY3R1YWxseSB3YW50IHRvIGV4cG9zZSB5b3VyIGFjY2VzcyB0b2tlbiBzZWNyZXQgbGlrZSB0aGlzIGluIGEgcmVhbCBhcHBsaWNhdGlvbi5cbiAgICBhY2Nlc3NUb2tlblNlY3JldDogXCJKRW9ZSWJqcTJOSmt5d1BvN0hCdV9wRzRHZ0VcIixcbiAgICBzZXJ2aWNlUHJvdmlkZXI6IHtzaWduYXR1cmVNZXRob2Q6IFwiSE1BQy1TSEExXCJ9XG4gIH0sXG4gICAgLypcbiAgICAqIEBkZXNjcmlwdGlvbiBGdW5jdGlvbiB0byBzZWFyY2ggZm9yIFllbHAgZGF0YSBmb3IgYSBzcGVjaWZpYyBwbGFjZVxuICAgICogQGNvbnN0cnVjdG9yXG4gICAgKiBAcGFyYW0ge29iamVjdH0gbWFya2VyIC0gY3VycmVudCBwbGFjZSBtYXJrZXIgZm9yIHdoaWNoIFllbHAgZGF0YSBpcyB0byBzZWFyY2hlZCBmb3JcbiAgICAqL1xuICBnZXRZZWxwRGF0YTogZnVuY3Rpb24oY3VycmVudE1hcmtlcikge1xuICAgIHZhciB0ZXJtcyA9ICdidXNpbmVzcyc7XG4gICAgdmFyIG5lYXIgPSBjdXJyZW50TWFya2VyLmZvcm1hdHRlZF9hZGRyZXNzO1xuICAgIHZhciBsaW1pdCA9IDM7XG5cbiAgICB2YXIgYWNjZXNzb3IgPSB7XG4gICAgICBjb25zdW1lclNlY3JldDogYXBwLm1vZGVsLmF1dGguY29uc3VtZXJTZWNyZXQsXG4gICAgICB0b2tlblNlY3JldDogYXBwLm1vZGVsLmF1dGguYWNjZXNzVG9rZW5TZWNyZXRcbiAgICB9O1xuXG4gICAgdmFyIHBhcmFtZXRlcnMgPSBbXTtcbiAgICBwYXJhbWV0ZXJzLnB1c2goWyd0ZXJtJywgdGVybXNdKTtcbiAgICBwYXJhbWV0ZXJzLnB1c2goWydsaW1pdCcsIGxpbWl0XSk7XG4gICAgcGFyYW1ldGVycy5wdXNoKFsnbG9jYXRpb24nLCBuZWFyXSk7XG4gICAgcGFyYW1ldGVycy5wdXNoKFsnY2FsbGJhY2snLCAnY2InXSk7XG4gICAgcGFyYW1ldGVycy5wdXNoKFsnb2F1dGhfY29uc3VtZXJfa2V5JywgYXBwLm1vZGVsLmF1dGguY29uc3VtZXJLZXldKTtcbiAgICBwYXJhbWV0ZXJzLnB1c2goWydvYXV0aF9jb25zdW1lcl9zZWNyZXQnLCBhcHAubW9kZWwuYXV0aC5jb25zdW1lclNlY3JldF0pO1xuICAgIHBhcmFtZXRlcnMucHVzaChbJ29hdXRoX3Rva2VuJywgYXBwLm1vZGVsLmF1dGguYWNjZXNzVG9rZW5dKTtcbiAgICBwYXJhbWV0ZXJzLnB1c2goWydvYXV0aF9zaWduYXR1cmVfbWV0aG9kJywgJ0hNQUMtU0hBMSddKTtcblxuICAgIHZhciBtZXNzYWdlID0ge1xuICAgICAgYWN0aW9uOiAnaHR0cDovL2FwaS55ZWxwLmNvbS92Mi9zZWFyY2gnLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHBhcmFtZXRlcnM6IHBhcmFtZXRlcnNcbiAgICB9O1xuXG4gICAgT0F1dGguc2V0VGltZXN0YW1wQW5kTm9uY2UobWVzc2FnZSk7XG4gICAgT0F1dGguU2lnbmF0dXJlTWV0aG9kLnNpZ24obWVzc2FnZSwgYWNjZXNzb3IpO1xuXG4gICAgdmFyIHBhcmFtZXRlck1hcCA9IE9BdXRoLmdldFBhcmFtZXRlck1hcChtZXNzYWdlLnBhcmFtZXRlcnMpO1xuICAgIHBhcmFtZXRlck1hcC5vYXV0aF9zaWduYXR1cmUgPVxuICAgIE9BdXRoLnBlcmNlbnRFbmNvZGUocGFyYW1ldGVyTWFwLm9hdXRoX3NpZ25hdHVyZSk7XG5cbiAgICAvLyB0aW1lIG91dCB5ZWxwIGFwaSByZXF1ZXN0XG4gICAgdmFyIGFwaVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgYXBwLm1vZGVsLmhhbmRsZUVycm9yKCdZZWxwIGRhdGEgcmV0cmlldmFsIGVycm9yIScpO1xuICAgIH0sIDUwMDApO1xuXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogbWVzc2FnZS5hY3Rpb24sXG4gICAgICBkYXRhOiBwYXJhbWV0ZXJNYXAsXG4gICAgICBjYWNoZTogdHJ1ZSxcbiAgICAgIGRhdGFUeXBlOiAnanNvbnAnLFxuICAgICAganNvbnBDYWxsYmFjazogJ2NiJ1xuICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgYXBwLm1vZGVsLmNsb3NlSW5mb1dpbmRvdygpO1xuICAgICAgLy8gQ2xlYXIgYXBpIHJlcXVlc3QgdGltZSBvdXRcbiAgICAgIGNsZWFyVGltZW91dChhcGlUaW1lb3V0KTtcblxuICAgICAgdmFyIGJ1c2luZXNzZXMgPSBkYXRhLmJ1c2luZXNzZXM7XG4gICAgICAvLyBDbGVhciBkYXRhXG4gICAgICBhcHAuVmlld01vZGVsLmN1cnJlbnRQbGFjZU5hbWUoW10pO1xuICAgICAgLy8gTG9hZCBkYXRhXG4gICAgICBhcHAuVmlld01vZGVsLmN1cnJlbnRQbGFjZU5hbWUucHVzaChjdXJyZW50TWFya2VyLnRpdGxlKTtcblxuICAgICAgdmFyIHRlbXBNYXAgPSBhcHAubW9kZWwubWFwO1xuXG4gICAgICBhcHAubW9kZWwuaW5mb1dpbmRvdy5vcGVuKHRlbXBNYXAsIGN1cnJlbnRNYXJrZXIpO1xuICAgICAgLy8gQ2xlYXIgYXJyYXlcbiAgICAgIGFwcC5WaWV3TW9kZWwuYnVzaW5lc3NlcyhbXSk7XG4gICAgICAvLyBMb2FkIGFycmF5XG4gICAgICBidXNpbmVzc2VzLmZvckVhY2goZnVuY3Rpb24oYnVzaW5lc3MpIHtcbiAgICAgICAgYXBwLlZpZXdNb2RlbC5idXNpbmVzc2VzLnB1c2goYnVzaW5lc3MpO1xuICAgICAgfSk7XG5cbiAgICAvLyBUaGlzIHdhcyB0aGUgYXBwcm9hY2ggaW1wbGVtZW50ZWQgaGVyZSBhIGNhbGxiYWNrIGlzIHVzZWQgaW4gdGhlIC5mYWlsKCkgbWV0aG9kcyBwYXJlbnRoZXNpc1xuICAgIC8vIGpxWEhSLmZhaWwoZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biApIHt9KTtcbiAgICAvLyBBbiBhbHRlcm5hdGl2ZSBjb25zdHJ1Y3QgdG8gdGhlIGVycm9yIGNhbGxiYWNrIG9wdGlvbixcbiAgICAvLyB0aGUgLmZhaWwoKSBtZXRob2QgcmVwbGFjZXMgdGhlIGRlcHJlY2F0ZWQgLmVycm9yKCkgbWV0aG9kLlxuICAgIC8vIFJlZmVyIHRvIGRlZmVycmVkLmZhaWwoKSBmb3IgaW1wbGVtZW50YXRpb24gZGV0YWlscy5cbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyovXG4gICAgfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcbiAgICAgIC8vIENhbGxzIGVycm9yIGZ1bmN0aW9uIHRvIHNldHVwIG1hcmtlciBpbmZvd2luZG93IHdpdGggZXJyb3IgZGV0YWlsc1xuICAgICAgYXBwLm1vZGVsLmhhbmRsZUVycm9yKHRleHRTdGF0dXMpO1xuICAgIH0pO1xuICB9LFxuICAvKipcbiAgKiBAZGVzY3JpcHRpb24gSGFuZGxlcyBlcnJvcnMgdGhhdCBtYXkgcmVzdWx0IGZyb20gdGhlIFllbHAgQXBpIHJlcXVlc3RcbiAgKiBAY29uc3RydWN0b3JcbiAgKiBAcGFyYW0ge29iamVjdH0gZXJyb3IgLSBkZXRhaWxzIG9mIHRoZSBlcnJvciB0aGF0IG9jY3VyZWRcbiAgKi9cbiAgaGFuZGxlRXJyb3I6IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgdmFyIHRlbXBNYXAgPSBhcHAubW9kZWwubWFwO1xuICAgIHZhciB0ZW1wTWFya2VyID0gYXBwLm1vZGVsLmN1cnJlbnRNYXJrZXI7XG4gICAgYXBwLm1vZGVsLmNsb3NlSW5mb1dpbmRvdygpO1xuICAgIGFwcC5tb2RlbC5lcnJvckluZm9XaW5kb3cub3Blbih0ZW1wTWFwLCB0ZW1wTWFya2VyKTtcblxuICAgIHZhciBtZXNzYWdlID0gJ0Vycm9yOiAnICtcbiAgICBlcnJvciArICcgXFxuXFxuUGxlYXNlIFRyeSBhZ2Fpbi4nO1xuICAgIGFwcC5WaWV3TW9kZWwueWVscEVycm9yTWVzc2FnZShbXSk7XG4gICAgYXBwLlZpZXdNb2RlbC55ZWxwRXJyb3JNZXNzYWdlLnB1c2gobWVzc2FnZSk7XG4gIH0sXG4gICAgLyoqIEBkZXNjcmlwdGlvbiBmYWxsYmFjayBmdW5jdGlvblxuICAgICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSB3aGVuIGRvbmVcbiAgICAqL1xuICBnb29nbGVFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgYXBwLlZpZXdNb2RlbC52aWV3KCdlcnJvci10ZW1wbGF0ZScpO1xuICAgIGFwcC5tb2RlbC5zdG9wID0gdHJ1ZTtcbiAgICByZXR1cm4gKHRydWUpO1xuICB9LFxuICAvKlxuICAqIEBkZXNjcmlwdGlvbiBpbml0KCkgc3RhcnRzIHRoZSBhcHBsaWNhdGlvblxuICAqL1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAkKCcubWFwRGl2JykuYXBwZW5kKGFwcC5tb2RlbC5nb29nbGVNYXApO1xuICAgIC8qXG4gICAgICBGb3IgdGhlIG1hcCB0byBiZSBkaXNwbGF5ZWQsIHRoZSBnb29nbGVNYXAgdmFyIG11c3QgYmVcbiAgICAgIGFwcGVuZGVkIHRvICNtYXBEaXYuXG4gICAgKi9cbiAgICBhcHAubW9kZWwubWFwID1cbiAgICBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwgYXBwLm1vZGVsLm1hcE9wdGlvbnMpO1xuICAgIGFwcC5tb2RlbC5zZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5QbGFjZXNTZXJ2aWNlKGFwcC5tb2RlbC5tYXApO1xuICAgIC8vIHNldCBhIHNpbmdsZSBpbnN0YW5jZSBvZiBpbmZvV2luZG93IHRvIGJlIHJldXNlZCBmb3IgZWFjaCBtYXJrZXJcbiAgICBhcHAubW9kZWwuaW5mb1dpbmRvdyA9IGFwcC5tb2RlbC5nZXRJbmZvV2luZG93KCk7XG4gICAgYXBwLm1vZGVsLmVycm9ySW5mb1dpbmRvdyA9IGFwcC5tb2RlbC5nZXRFcnJvckluZm9XaW5kb3coKTtcbiAgICBhcHAubW9kZWwubG9hZGluZ0luZm9XaW5kb3cgPSBhcHAubW9kZWwuZ2V0TG9hZGluZ0luZm9XaW5kb3coKTtcbiAgICAvLyBhZGQgbGlzdGVuZXIgdG8gcmVnaXN0ZXIgYmluZGluZ3Mgd2l0aCB0aGUgZG9tXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoYXBwLm1vZGVsLmluZm9XaW5kb3csICdkb21yZWFkeScsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCFhcHAubW9kZWwuaXNJbmZvV2luZG93TG9hZGVkKSB7XG4gICAgICAgIGtvLmFwcGx5QmluZGluZ3MoYXBwVmlld01vZGVsLCAkKFwiI2luZm8td2luZG93XCIpWzBdKTtcbiAgICAgICAgYXBwLm1vZGVsLmlzSW5mb1dpbmRvd0xvYWRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZ29vZ2xlLm1hcHMuZXZlbnRcbiAgICAuYWRkTGlzdGVuZXIoYXBwLm1vZGVsLmVycm9ySW5mb1dpbmRvdywgJ2RvbXJlYWR5JywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIWFwcC5tb2RlbC5pc0Vycm9ySW5mb1dpbmRvd0xvYWRlZCkge1xuICAgICAgICBrby5hcHBseUJpbmRpbmdzKGFwcFZpZXdNb2RlbCwgJChcIiNlcnJvci1pbmZvLXdpbmRvd1wiKVswXSk7XG4gICAgICAgIGFwcC5tb2RlbC5pc0Vycm9ySW5mb1dpbmRvd0xvYWRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gU2V0cyB0aGUgYm91bmRhcmllcyBvZiB0aGUgbWFwIGJhc2VkIG9uIHBpbiBsb2NhdGlvbnNcbiAgICB3aW5kb3cubWFwQm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xuICAgIC8vIEl0ZXJhdGVzIHRocm91Z2ggdGhlIGFycmF5IG9mIGxvY2F0aW9ucywgY3JlYXRlcyBhIHNlYXJjaCBvYmplY3QgZm9yIGVhY2ggbG9jYXRpb25cbiAgICBhcHAubW9kZWwubG9jYXRpb25zLmZvckVhY2goZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgIC8vIHRoZSBzZWFyY2ggcmVxdWVzdCBvYmplY3RcbiAgICAgIHZhciByZXF1ZXN0ID0ge3F1ZXJ5OiBwbGFjZX07XG4gICAgICAvLyBBY3R1YWxseSBzZWFyY2hlcyB0aGUgR29vZ2xlIE1hcHMgQVBJIGZvciBsb2NhdGlvbiBkYXRhIGFuZCBydW5zIHRoZSBjYWxsYmFja1xuICAgICAgLy8gZnVuY3Rpb24gd2l0aCB0aGUgc2VhcmNoIHJlc3VsdHMgYWZ0ZXIgZWFjaCBzZWFyY2guXG4gICAgICBhcHAubW9kZWwuc2VydmljZS50ZXh0U2VhcmNoKHJlcXVlc3QsIGFwcC5tb2RlbC50ZXh0U2VyYWNoQ2FsbGJhY2spO1xuICAgIH0pO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50XG4gICAgLmFkZExpc3RlbmVyKGFwcC5tb2RlbC5tYXAsICdjbGljaycsIGFwcC5tb2RlbC5jbG9zZUluZm9XaW5kb3cpO1xuICAgICAgLy8gQGRlc2NyaXB0aW9uIFZhbmlsbGEgSlMgd2F5IHRvIGxpc3RlbiBmb3IgcmVzaXppbmcgb2YgdGhlIHdpbmRvd1xuICAgICAgLy8gYW5kIGFkanVzdCBtYXAgYm91bmRzXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgbWFwIGJvdW5kcyBnZXQgdXBkYXRlZCBvbiBwYWdlIHJlc2l6ZVxuICAgICAgYXBwLm1vZGVsLm1hcC5maXRCb3VuZHMod2luZG93Lm1hcEJvdW5kcyk7XG4gICAgfSk7XG4gIH0sXG4gIC8qXG4gICogQGRlc2NyaXB0aW9uIENsb3NlcyBpbmZvcm1hdGlvbiB3aW5kb3dzXG4gICovXG4gIGNsb3NlSW5mb1dpbmRvdzogZnVuY3Rpb24oKSB7XG4gICAgYXBwLm1vZGVsLmluZm9XaW5kb3cuY2xvc2UoKTtcbiAgICBhcHAubW9kZWwuZXJyb3JJbmZvV2luZG93LmNsb3NlKCk7XG4gICAgYXBwLm1vZGVsLmxvYWRpbmdJbmZvV2luZG93LmNsb3NlKCk7XG4gIH0sXG4gIC8qXG4gICogQGRlc2NyaXB0aW9uIGNhbGxiYWNrKHJlc3VsdHMsIHN0YXR1cykgbWFrZXMgc3VyZSB0aGUgc2VhcmNoIHJldHVybmVkIHJlc3VsdHMgZm9yIGEgbG9jYXRpb24uXG4gIElmIHNvLCBpdCBjcmVhdGVzIGEgbmV3IG1hcCBtYXJrZXIgZm9yIHRoYXQgbG9jYXRpb24uXG4gICogQHBhcmFtIHtvYmplY3R9IHJlc3VsdHMgLSBzZWFyY2ggcmV0dXJuZWQgcmVzdWx0cyBmb3IgYSBsb2NhdGlvblxuICAqIEBwYXJhbSB7c3RyaW5nfSBzdGF0dXMgLSBwbGFjZXMgYXBpIHJlcXVlc3Qgc3RhdHVzXG4gICovXG4gIHRleHRTZXJhY2hDYWxsYmFjazogZnVuY3Rpb24ocmVzdWx0cywgc3RhdHVzKSB7XG4gICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMucGxhY2VzLlBsYWNlc1NlcnZpY2VTdGF0dXMuT0spIHtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHNbMF0pO1xuICAgICAgYXBwLm1vZGVsLmNyZWF0ZU1hcE1hcmtlcihyZXN1bHRzWzBdKTtcblxuICAgICAgdmFyIHBsYWNlID0gcmVzdWx0c1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tYWxlcnQqL1xuICAgICAgYXBwLm1vZGVsLmdvb2dsZUVycm9yKCk7XG4gICAgICB3aW5kb3cuYWxlcnQoJ0Vycm9yIHJldHJpZXZpbmcgbGlzdCBvZiBwbGFjZXMsIFRyeSBBZ2FpbicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfSxcbiAgLypcbiAgQGRlc2NyaXB0aW9uIGNyZWF0ZU1hcE1hcmtlcihwbGFjZURhdGEpIHJlYWRzIEdvb2dsZSBQbGFjZXMgc2VhcmNoIHJlc3VsdHMgdG8gY3JlYXRlIG1hcCBwaW5zLlxuICBwbGFjZURhdGEgaXMgdGhlIG9iamVjdCByZXR1cm5lZCBmcm9tIHNlYXJjaCByZXN1bHRzIGNvbnRhaW5pbmcgaW5mb3JtYXRpb25cbiAgYWJvdXQgYSBzaW5nbGUgbG9jYXRpb24uXG4gIEBwYXJhbSB7b2JqZWN0fSBwbGFjZURhdGEgLSBHb29nbGUgUGxhY2VzIHNlYXJjaCByZXN1bHQgZGF0YVxuICAqL1xuICBjcmVhdGVNYXBNYXJrZXI6IGZ1bmN0aW9uKHBsYWNlRGF0YSkge1xuICAgIC8vIFRoZSBuZXh0IGxpbmVzIHNhdmUgbG9jYXRpb24gZGF0YSBmcm9tIHRoZSBzZWFyY2ggcmVzdWx0IG9iamVjdCB0byBsb2NhbCB2YXJpYWJsZXNcbiAgICB2YXIgbGF0ID0gcGxhY2VEYXRhLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCgpOyAgLy8gbGF0aXR1ZGUgZnJvbSB0aGUgcGxhY2Ugc2VydmljZVxuICAgIHZhciBsb24gPSBwbGFjZURhdGEuZ2VvbWV0cnkubG9jYXRpb24ubG5nKCk7ICAvLyBsb25naXR1ZGUgZnJvbSB0aGUgcGxhY2Ugc2VydmljZVxuICAgIHZhciBuYW1lID0gcGxhY2VEYXRhLm5hbWU7ICAgLy8gbmFtZSBvZiB0aGUgcGxhY2UgZnJvbSB0aGUgcGxhY2Ugc2VydmljZVxuICAgIGFwcC5tb2RlbC5ib3VuZHMgPSB3aW5kb3cubWFwQm91bmRzOyAgICAgICAgICAgIC8vIGN1cnJlbnQgYm91bmRhcmllcyBvZiB0aGUgbWFwIHdpbmRvd1xuXG4gICAgLy8gbWFya2VyIGlzIGFuIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgZGF0YSBhYm91dCB0aGUgcGluIGZvciBhIHNpbmdsZSBsb2NhdGlvblxuICAgIHZhciBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgIG1hcDogYXBwLm1vZGVsLm1hcCxcbiAgICAgIHBvc2l0aW9uOiBwbGFjZURhdGEuZ2VvbWV0cnkubG9jYXRpb24sXG4gICAgICB0aXRsZTogbmFtZSxcbiAgICAgIHBsYWNlSWQ6IHBsYWNlRGF0YS5wbGFjZV9pZCxcbiAgICAgIGRyYWdnYWJsZTogdHJ1ZSxcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1AsXG4gICAgICBmb3JtYXR0ZWRfYWRkcmVzczogcGxhY2VEYXRhLmZvcm1hdHRlZF9hZGRyZXNzXG4gICAgICAvLyBpY29uOiBwbGFjZURhdGEuaWNvblxuICAgIH0pO1xuXG4gICAgLy8gYWRkIG1hcmtlcnMgdG8gbWFya2VyIGFycmF5XG4gICAgYXBwLm1vZGVsLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICAgIGFwcC5WaWV3TW9kZWwubWFya2Vycy5wdXNoKG1hcmtlcik7XG5cbiAgICAvLyBDaGVjayB0byBzZWUgaWYgYWxsIGluaXRpYWwgZGF0YSB3YXMgcmVjZWl2ZWRcbiAgICBpZiAoYXBwLm1vZGVsLmxvY2F0aW9ucy5sZW5ndGggPT09IGFwcC5tb2RlbC5tYXJrZXJzLmxlbmd0aCkge1xuICAgICAgYXBwLm1vZGVsLnRpbWVkT3V0ID0gZmFsc2U7XG4gICAgICBjbGVhclRpbWVvdXQoYXBwLm1vZGVsLnJlcXVlc3RUaW1lcik7XG4gICAgfVxuXG4gICAgLy8gYWRkIGxpc3RlbmVyIHRvIHJlc3BvbmQgdG8gY2xpY2sgZXZlbnRzIG9uIG1hcmtlcnNcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgYXBwLm1vZGVsLm1hcC5wYW5UbyhtYXJrZXIuZ2V0UG9zaXRpb24oKSk7XG5cbiAgICAgIC8vIHN0b3BzIGJvdW5jZSBhbmltYXRpb24gYWZ0ZXIgNSBzZWNvbmRzXG4gICAgICB2YXIgdGltZU91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIG1hcmtlci5zZXRBbmltYXRpb24obnVsbCk7XG4gICAgICB9LCA1MDAwKTtcblxuICAgICAgYXBwLm1vZGVsLmN1cnJlbnRNYXJrZXIgPSBudWxsO1xuICAgICAgYXBwLm1vZGVsLmN1cnJlbnRNYXJrZXIgPSBtYXJrZXI7XG4gICAgICB2YXIgdGVtcE1hcCA9IGFwcC5tb2RlbC5tYXA7XG4gICAgICBhcHAubW9kZWwuY2xvc2VJbmZvV2luZG93KCk7XG4gICAgICBhcHAubW9kZWwubG9hZGluZ0luZm9XaW5kb3cub3Blbih0ZW1wTWFwLCBtYXJrZXIpO1xuICAgICAgLy8gVGhpcyByZXF1ZXN0cyBhZGRpdGlvbmFsIHBsYWNlIGRldGFpbHMgYnkgaWQgZm9yIHRoZSBwbGFjZSBtYXJrZXIgY2xpY2tlZFxuICAgICAgYXBwLm1vZGVsLmdldFllbHBEYXRhKGFwcC5tb2RlbC5jdXJyZW50TWFya2VyKTtcbiAgICB9KTtcbiAgICAvLyBhZGQgbGlzdGVuZXIgdG8gdHJpZ2dlciBib3VuY2UgYW5pbWF0aW9uIGZvciBtYXJrZXIgaWNvbiBhZnRlciB0aGV5IGhhdmUgYmVlbiBjbGlja2VkXG4gICAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsIGFwcC5WaWV3TW9kZWwudG9nZ2xlQm91bmNlKTtcblxuICAgIC8vIHRoaXMgaXMgd2hlcmUgdGhlIHBpbiBhY3R1YWxseSBnZXRzIGFkZGVkIHRvIHRoZSBtYXAuXG4gICAgLy8gYm91bmRzLmV4dGVuZCgpIHRha2VzIGluIGEgbWFwIGxvY2F0aW9uIG9iamVjdFxuICAgIGFwcC5tb2RlbC5ib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcobGF0LCBsb24pKTtcbiAgICAvLyBmaXQgdGhlIG1hcCB0byB0aGUgbmV3IG1hcmtlclxuICAgIGFwcC5tb2RlbC5tYXAuZml0Qm91bmRzKGFwcC5tb2RlbC5ib3VuZHMpO1xuICAgLy8gY2VudGVyIHRoZSBtYXBcbiAgICAvLyBhcHAubW9kZWwubWFwLnNldENlbnRlcihhcHAubW9kZWwuYm91bmRzLmdldENlbnRlcigpKTtcbiAgICBhcHAubW9kZWwuY2VudGVyTWFwKCk7XG4gIH1cblxufTtcblxudmFyIGFwcFZpZXdNb2RlbCA9IG5ldyBhcHAuVmlld01vZGVsKCk7XG5rby5hcHBseUJpbmRpbmdzKGFwcFZpZXdNb2RlbCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
